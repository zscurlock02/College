% Press "Run" to load the data in to the MATLAB workspace. To get started,
% try typing "plot(freqHz, mag)" in the command window (after running this
% file). 
% Type "help semilogx" and "help plot" or go to the Mathworks documentation 
% page on "plot" to learn more. Pay special attention to "hold."
% Other useful things: help grid, help subplot, help rad2deg.
freq_hz = [...
   100.000, 	   112.200, 	   125.900, ...
   141.300, 	   158.500, 	   177.800, ...
   199.500, 	   223.900, 	   251.200, ...
   281.800, 	   316.200, 	   354.800, ...
   398.100, 	   446.700, 	   501.200, ...
   562.300, 	   631.000, 	   707.900, ...
   794.300, 	   891.300, 	  1000.000, ...
  1122.000, 	  1259.000, 	  1413.000, ...
  1585.000, 	  1778.000, 	  1995.000, ...
  2239.000, 	  2512.000, 	  2818.000, ...
  3162.000, 	  3548.000, 	  3981.000, ...
  4467.000, 	  5012.000, 	  5623.000, ...
  6310.000, 	  7079.000, 	  7943.000, ...
  8913.000, 	 10000.000, 	 11220.000, ...
 12590.000, 	 14130.000, 	 15850.000, ...
 17780.000, 	 19950.000, 	 22390.000, ...
 25120.000, 	 28180.000, 	 31620.000, ...
 35480.000, 	 39810.000, 	 44670.000, ...
 50120.000, 	 56230.000, 	 63100.000, ...
 70790.000, 	 79430.000, 	 89130.000, ...
100000.000];

mag_dB = [...
     6.773, 	     6.762, 	     6.749, ...
     6.732, 	     6.710, 	     6.684, ...
     6.650, 	     6.609, 	     6.558, ...
     6.496, 	     6.420, 	     6.326, ...
     6.213, 	     6.073, 	     5.906, ...
     5.705, 	     5.466, 	     5.185, ...
     4.857, 	     4.478, 	     4.044, ...
     3.560, 	     3.021, 	     2.427, ...
     1.783, 	     1.096, 	     0.366, ...
    -0.405, 	    -1.206, 	    -2.008, ...
    -2.861, 	    -3.765, 	    -4.658, ...
    -5.566, 	    -6.446, 	    -7.374, ...
    -8.330, 	    -9.275, 	   -10.235, ...
   -11.193, 	   -12.150, 	   -13.115, ...
   -14.095, 	   -15.073, 	   -16.062, ...
   -17.043, 	   -17.932, 	   -18.928, ...
   -20.018, 	   -21.020, 	   -21.987, ...
   -23.009, 	   -24.114, 	   -25.155, ...
   -26.108, 	   -27.179, 	   -28.276, ...
   -29.407, 	   -30.586, 	   -31.928, ...
   -33.225];

mag_v = [...
     2.181, 	     2.178, 	     2.175, ...
     2.171, 	     2.165, 	     2.159, ...
     2.150, 	     2.140, 	     2.128, ...
     2.113, 	     2.094, 	     2.072, ...
     2.045, 	     2.012, 	     1.974, ...
     1.929, 	     1.876, 	     1.817, ...
     1.749, 	     1.674, 	     1.593, ...
     1.507, 	     1.416, 	     1.322, ...
     1.228, 	     1.135, 	     1.043, ...
     0.954, 	     0.870, 	     0.794, ...
     0.719, 	     0.648, 	     0.585, ...
     0.527, 	     0.476, 	     0.428, ...
     0.383, 	     0.344, 	     0.308, ...
     0.276, 	     0.247, 	     0.221, ...
     0.197, 	     0.176, 	     0.157, ...
     0.141, 	     0.127, 	     0.113, ...
     0.100, 	     0.089, 	     0.080, ...
     0.071, 	     0.062, 	     0.055, ...
     0.049, 	     0.044, 	     0.039, ...
     0.034, 	     0.030, 	     0.025, ...
     0.022];

mag_vout = [...
     1.838, 	     1.838, 	     1.838, ...
     1.838, 	     1.838, 	     1.837, ...
     1.836, 	     1.834, 	     1.830, ...
     1.825, 	     1.818, 	     1.807, ...
     1.794, 	     1.775, 	     1.752, ...
     1.724, 	     1.689, 	     1.647, ...
     1.598, 	     1.542, 	     1.479, ...
     1.410, 	     1.336, 	     1.257, ...
     1.175, 	     1.093, 	     1.010, ...
     0.929, 	     0.851, 	     0.778, ...
     0.708, 	     0.639, 	     0.578, ...
     0.521, 	     0.472, 	     0.424, ...
     0.380, 	     0.342, 	     0.306, ...
     0.274, 	     0.246, 	     0.220, ...
     0.196, 	     0.175, 	     0.157, ...
     0.140, 	     0.126, 	     0.112, ...
     0.098, 	     0.088, 	     0.079, ...
     0.071, 	     0.062, 	     0.055, ...
     0.050, 	     0.044, 	     0.039, ...
     0.034, 	     0.030, 	     0.026, ...
     0.022];

mag_vin = [...
     0.843, 	     0.844, 	     0.845, ...
     0.847, 	     0.849, 	     0.851, ...
     0.854, 	     0.857, 	     0.860, ...
     0.864, 	     0.868, 	     0.872, ...
     0.877, 	     0.882, 	     0.888, ...
     0.894, 	     0.900, 	     0.907, ...
     0.913, 	     0.921, 	     0.928, ...
     0.936, 	     0.943, 	     0.951, ...
     0.957, 	     0.963, 	     0.969, ...
     0.973, 	     0.977, 	     0.981, ...
     0.984, 	     0.986, 	     0.988, ...
     0.989, 	     0.991, 	     0.992, ...
     0.992, 	     0.994, 	     0.994, ...
     0.994, 	     0.995, 	     0.995, ...
     0.995, 	     0.995, 	     0.995, ...
     0.995, 	     0.992, 	     0.992, ...
     0.986, 	     0.985, 	     0.998, ...
     0.999, 	     1.000, 	     1.001, ...
     1.001, 	     1.002, 	     1.003, ...
     1.004, 	     1.005, 	     1.009, ...
     1.009];

phase_rad = [...
     3.047, 	     3.036, 	     3.023, ...
     3.009, 	     2.993, 	     2.975, ...
     2.955, 	     2.933, 	     2.909, ...
     2.882, 	     2.852, 	     2.819, ...
     2.784, 	     2.745, 	     2.702, ...
     2.657, 	     2.609, 	     2.559, ...
     2.506, 	     2.452, 	     2.396, ...
     2.341, 	     2.286, 	     2.231, ...
     2.179, 	     2.128, 	     2.080, ...
     2.035, 	     1.993, 	     1.954, ...
     1.917, 	     1.883, 	     1.852, ...
     1.824, 	     1.798, 	     1.775, ...
     1.753, 	     1.733, 	     1.714, ...
     1.697, 	     1.681, 	     1.666, ...
     1.652, 	     1.639, 	     1.626, ...
     1.613, 	     1.601, 	     1.589, ...
     1.577, 	     1.565, 	     1.552, ...
     1.539, 	     1.526, 	     1.512, ...
     1.496, 	     1.480, 	     1.462, ...
     1.442, 	     1.423, 	     1.398, ...
     1.373];

omega = 2 * pi *freq_hz;

transfer = (-15399.22)./((j.*omega)+6817.5);
nominal_transfer = (-15594.7) ./ ((j .* omega) + 4296.1);

calc_phase = angle(transfer);
nominal_calc_phase = angle(nominal_transfer);

nominal_calc_mag = 20 * log10(abs(nominal_transfer));
calc_mag = 20 * log10(abs(transfer));

semilogx(freq_hz,mag_dB);
hold on
%semilogx(freq_hz,calc_mag);
hold on
%semilogx(freq_hz, nominal_calc_mag);


xlabel("Frequency, Hz");
ylabel("Mag, dB");