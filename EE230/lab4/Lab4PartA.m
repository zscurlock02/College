% Press "Run" to load the data in to the MATLAB workspace. To get started,
% try typing "plot(freqHz, mag)" in the command window (after running this
% file). 
% Type "help semilogx" and "help plot" or go to the Mathworks documentation 
% page on "plot" to learn more. Pay special attention to "hold."
% Other useful things: help grid, help subplot, help rad2deg.
freq_hz = [...
   100.000, 	   112.200, 	   125.900, ...
   141.300, 	   158.500, 	   177.800, ...
   199.500, 	   223.900, 	   251.200, ...
   281.800, 	   316.200, 	   354.800, ...
   398.100, 	   446.700, 	   501.200, ...
   562.300, 	   631.000, 	   707.900, ...
   794.300, 	   891.300, 	  1000.000, ...
  1122.000, 	  1259.000, 	  1413.000, ...
  1585.000, 	  1778.000, 	  1995.000, ...
  2239.000, 	  2512.000, 	  2818.000, ...
  3162.000, 	  3548.000, 	  3981.000, ...
  4467.000, 	  5012.000, 	  5623.000, ...
  6310.000, 	  7079.000, 	  7943.000, ...
  8913.000, 	 10000.000, 	 11220.000, ...
 12590.000, 	 14130.000, 	 15850.000, ...
 17780.000, 	 19950.000, 	 22390.000, ...
 25120.000, 	 28180.000, 	 31620.000, ...
 35480.000, 	 39810.000, 	 44670.000, ...
 50120.000, 	 56230.000, 	 63100.000, ...
 70790.000, 	 79430.000, 	 89130.000, ...
100000.000];

mag_dB = [...
     3.184, 	     3.175, 	     3.163, ...
     3.149, 	     3.131, 	     3.111, ...
     3.085, 	     3.052, 	     3.013, ...
     2.964, 	     2.904, 	     2.830, ...
     2.737, 	     2.625, 	     2.489, ...
     2.325, 	     2.128, 	     1.893, ...
     1.615, 	     1.291, 	     0.915, ...
     0.488, 	     0.007, 	    -0.528, ...
    -1.117, 	    -1.756, 	    -2.439, ...
    -3.170, 	    -3.934, 	    -4.731, ...
    -5.567, 	    -6.418, 	    -7.248, ...
    -8.140, 	    -9.062, 	    -9.981, ...
   -10.957, 	   -11.893, 	   -12.759, ...
   -13.713, 	   -14.736, 	   -15.698, ...
   -16.564, 	   -17.537, 	   -18.509, ...
   -19.508, 	   -20.492, 	   -21.507, ...
   -22.502, 	   -23.577, 	   -24.584, ...
   -25.492, 	   -26.516, 	   -27.545, ...
   -28.593, 	   -29.652, 	   -30.866, ...
   -31.979, 	   -33.121, 	   -34.303, ...
   -35.538];

mag_v = [...
     1.443, 	     1.441, 	     1.439, ...
     1.437, 	     1.434, 	     1.431, ...
     1.426, 	     1.421, 	     1.415, ...
     1.407, 	     1.397, 	     1.385, ...
     1.370, 	     1.353, 	     1.332, ...
     1.307, 	     1.278, 	     1.244, ...
     1.204, 	     1.160, 	     1.111, ...
     1.058, 	     1.001, 	     0.941, ...
     0.879, 	     0.817, 	     0.755, ...
     0.694, 	     0.636, 	     0.580, ...
     0.527, 	     0.478, 	     0.434, ...
     0.392, 	     0.352, 	     0.317, ...
     0.283, 	     0.254, 	     0.230, ...
     0.206, 	     0.183, 	     0.164, ...
     0.149, 	     0.133, 	     0.119, ...
     0.106, 	     0.094, 	     0.084, ...
     0.075, 	     0.066, 	     0.059, ...
     0.053, 	     0.047, 	     0.042, ...
     0.037, 	     0.033, 	     0.029, ...
     0.025, 	     0.022, 	     0.019, ...
     0.017];

mag_vout = [...
     1.237, 	     1.237, 	     1.238, ...
     1.238, 	     1.238, 	     1.238, ...
     1.238, 	     1.238, 	     1.236, ...
     1.234, 	     1.230, 	     1.225, ...
     1.218, 	     1.208, 	     1.196, ...
     1.180, 	     1.160, 	     1.136, ...
     1.107, 	     1.073, 	     1.035, ...
     0.992, 	     0.945, 	     0.895, ...
     0.842, 	     0.787, 	     0.732, ...
     0.676, 	     0.622, 	     0.569, ...
     0.519, 	     0.471, 	     0.430, ...
     0.388, 	     0.350, 	     0.315, ...
     0.282, 	     0.253, 	     0.229, ...
     0.206, 	     0.183, 	     0.164, ...
     0.148, 	     0.132, 	     0.119, ...
     0.106, 	     0.094, 	     0.084, ...
     0.074, 	     0.065, 	     0.059, ...
     0.053, 	     0.047, 	     0.042, ...
     0.037, 	     0.033, 	     0.029, ...
     0.025, 	     0.022, 	     0.020, ...
     0.017];

mag_vin = [...
     0.858, 	     0.859, 	     0.860, ...
     0.862, 	     0.863, 	     0.865, ...
     0.868, 	     0.871, 	     0.874, ...
     0.877, 	     0.881, 	     0.884, ...
     0.889, 	     0.893, 	     0.898, ...
     0.903, 	     0.908, 	     0.913, ...
     0.919, 	     0.925, 	     0.932, ...
     0.938, 	     0.945, 	     0.951, ...
     0.958, 	     0.963, 	     0.969, ...
     0.974, 	     0.978, 	     0.981, ...
     0.985, 	     0.987, 	     0.990, ...
     0.991, 	     0.993, 	     0.994, ...
     0.995, 	     0.996, 	     0.997, ...
     0.997, 	     0.998, 	     0.997, ...
     0.998, 	     0.998, 	     0.998, ...
     0.998, 	     0.995, 	     0.996, ...
     0.989, 	     0.989, 	     1.002, ...
     1.002, 	     1.003, 	     1.004, ...
     1.005, 	     1.006, 	     1.007, ...
     1.008, 	     1.009, 	     1.012, ...
     1.013];

phase_rad = [...
     3.058, 	     3.048, 	     3.037, ...
     3.025, 	     3.011, 	     2.995, ...
     2.977, 	     2.958, 	     2.936, ...
     2.912, 	     2.885, 	     2.856, ...
     2.824, 	     2.788, 	     2.750, ...
     2.708, 	     2.663, 	     2.615, ...
     2.565, 	     2.513, 	     2.459, ...
     2.403, 	     2.348, 	     2.293, ...
     2.238, 	     2.186, 	     2.135, ...
     2.087, 	     2.041, 	     1.999, ...
     1.960, 	     1.923, 	     1.889, ...
     1.858, 	     1.830, 	     1.804, ...
     1.781, 	     1.759, 	     1.739, ...
     1.721, 	     1.704, 	     1.689, ...
     1.674, 	     1.660, 	     1.647, ...
     1.635, 	     1.624, 	     1.612, ...
     1.601, 	     1.591, 	     1.580, ...
     1.569, 	     1.558, 	     1.547, ...
     1.535, 	     1.523, 	     1.510, ...
     1.497, 	     1.482, 	     1.466, ...
     1.447];

omega = 2 * pi *freq_hz;

transfer = (-1.522) .* (7734.7)./((j.*omega)+7734.7);
nominal_transfer = (-11640.21) ./ ((j .* omega) + 5291);

calc_phase = angle(transfer);
nominal_calc_phase = angle(nominal_transfer);

nominal_calc_mag = 20 * log10(abs(nominal_transfer));
calc_mag = 20 * log10(abs(transfer));

semilogx(freq_hz,phase_rad);
hold on
semilogx(freq_hz,calc_phase);
hold on
semilogx(freq_hz, nominal_calc_phase);


xlabel("Frequency, Hz");
ylabel("Phase, rad");