/*
 * checkpoints.c
 *
 *  Created on: Feb 2, 2023
 *      Author: scurlock
 */

#include "Timer.h"
#include "lcd.h"
#include "movement.h"
#include "open_interface.h"
#include "cyBot_uart.h"
#include "cyBot_Scan.h"

void printToPutty(char data[]);

int main(void) {
//    oi_t *sensor_data = oi_alloc();
//    oi_init(sensor_data);
//    lcd_init();
    cyBot_uart_init();

//    char c = (char)cyBot_getByte();
//    lcd_putc(c);
//    cyBot_sendByte(c);
//    char c = 'k';
//    while (c != 'f') {
//        c = (char)cyBot_getByte();
//        if (c == 'w') {
//            move_forward(sensor_data, 100);
//        }
//        if (c == 'a') {
//            turn_left(sensor_data, 90);
//        }
//        if (c == 's') {
//            move_backward(sensor_data, 100);          CHECKPOINT 1
//        }
//        if (c == 'd') {
//            turn_right(sensor_data, 90);
//        }
//    }

//    timer_init();
//    lcd_init();
//    cyBOT_init_Scan(0b0111);
//    cyBOT_SERVO_cal();

    cyBOT_Scan_t getScan;
    cyBOT_init_Scan(0b0011);

    right_calibration_value = 243250;
    left_calibration_value = 1225000;

    printToPutty("Degrees   PING Distance\n\r");
    char data[50];
    int i;
    for (i = 0; i <= 180; i++) {
        cyBOT_Scan(i, &getScan);
        sprintf(data, "%d        %f\n\r", i, getScan.sound_dist);    // CHECKPOINT 2
        printToPutty(data);
    }

//    int i;
//    int initialAngle;
//    int finalAngle;
//    int degreeWidthSmallest = 1000000;
//    int degreeWidthCompare;
//    int smallestObjAngle;
//    int counter;
//
//    for (i = 0; i  < 180; i += 2) {
//
//    }
//
//    for (i = 0; i < 180; ++i) {
//        cyBOT_Scan(i, &getScan);
//        if (getScan.sound_dist < 60) {
//            initialAngle = i;
//            while (getScan.sound_dist < 60 || counter > 0) {
//                ++i;
//                cyBOT_Scan(i, &getScan);
//            }
//            finalAngle = i;
//            degreeWidthCompare = finalAngle - initialAngle;
//            if (degreeWidthCompare < degreeWidthSmallest) {
//                degreeWidthSmallest = degreeWidthCompare;
//                smallestObjAngle = (finalAngle + initialAngle) / 2;
//            }
//        }
//    }
//    cyBOT_Scan(smallestObjAngle, &getScan);

    oi_free(sensor_data);
    return 0;
}

void printToPutty(char data[]) {
    int i;
    for (i = 0; i < strlen(data); ++i) {
        cyBot_sendByte(data[i]);
    }
}

